<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Saturn's Digital Doorbell</title>
  <!-- Favicon -->
  <link rel="icon" href="IMG_1066.png">
  <style>
    /* Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #000; /* true black for OLED */
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    #particles-js {
      position: absolute;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

    .glass-box {
      position: fixed;
      z-index: 1;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 20px;
      padding: 40px;
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
      box-shadow: 0 0 20px rgba(255,255,255,0.1);
      text-align: center;
      width: 35vh;
    }

    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
      outline: none;
      margin-bottom: 30px;
      text-align: center;
    }

    button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.15);
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      background: rgba(0,122,255,1);
    }

    /* Right-side log panel */
    #logPanel {
      position: fixed;
      top: 0;
      right: 0;
      width: 250px;
      height: 100vh;
      background: rgba(20,20,20,0.5);
      color: #fff;
      padding: 20px;
      overflow-y: auto;
      font-size: 14px;
      -webkit-backdrop-filter: blur(4px);
      backdrop-filter: blur(4px);
      border-left: 1px solid rgba(255,255,255,0.1);
      box-shadow: -2px 0 20px rgba(0,0,0,0.6);
      z-index: 5;
    }
    /* Hide log panel on mobile */
    @media (max-width: 900px) {
      #logPanel {
        display: none;
      }
    }
    #logPanel h3 {
      margin-bottom: 10px;
      font-weight: 600;
    }

    .log-entry {
      margin-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 6px;
    }

    .reason-box {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 40vh;
      padding: 20px;
      z-index: 2;
    }

    .reason-box textarea {
      width: 100%;
      min-height: 60px;
      resize: none;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 14px;
      outline: none;
      text-align: left;
    }

    .reason-text {
      margin-top: 6px;
      font-size: 12px;
      opacity: 0.8;
      display: none;
    }

    .log-entry.open .reason-text {
      display: block;
    }
  </style>
</head>
<body>
  <div id="particles-js"></div>

  <div class="glass-box">
    <h2>Ping SleeperOfSaturn</h2>
    <br>
    <input type="text" id="nameInput" placeholder="Enter your name">
    <button onclick="sendPing()">Send Ping</button>
  </div>

  <!-- Bottom glass panel for reason -->
  <div class="glass-box reason-box">
    <textarea id="reasonInput" placeholder="Brief reason for ping..."></textarea>
  </div>

  <!-- Persistent log panel -->
  <div id="logPanel">
    <h3>Recent Pings</h3>
    <div id="logEntries">Loadingâ€¦</div>
  </div>

  <!-- particles.js library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>

  <script>
    // Webhook map
    const WEBHOOKS = {
      "aadity": "https://api.pushcut.io/yIplredoAJ4kPmQMqcja7/notifications/Aadity%E2%80%99s%20Ping",
      "ganik": "https://api.pushcut.io/yIplredoAJ4kPmQMqcja7/notifications/Ganik%E2%80%99s%20Ping",
      "chinmay": "https://api.pushcut.io/yIplredoAJ4kPmQMqcja7/notifications/Chinmay%E2%80%99s%20Ping"
      // Add more like: "john": "https://api.pushcut.io/.../John%20Ping"
    };

    // jsonbin.io config
    const JSONBIN_ID = "68a31acaae596e708fcd3922"; 
    const JSONBIN_KEY = "$2a$10$EFoDNu/JdnMgdB4fjvG3O.MyCIp.y0zU0PKSuIEnzG6.YfyiPdeUu"; 
    const LOG_REFRESH_INTERVAL = 15000; // 15s auto-refresh

    // Send ping & update log
    async function sendPing() {
      const nameInput = document.getElementById("nameInput").value.trim().toLowerCase();
      const reasonInput = document.getElementById("reasonInput").value.trim();

      if (!nameInput) return alert("Please enter your name.");
      if (!(nameInput in WEBHOOKS)) return alert("Name not recognized.");

      const url = WEBHOOKS[nameInput];

      // Pushcut ping
      fetch(url, { mode: "no-cors" })
        .then(() => alert("Ping sent for " + nameInput.charAt(0).toUpperCase() + nameInput.slice(1)))
        .catch(() => alert("Failed to send ping"));

      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
          headers: { "X-Master-Key": JSONBIN_KEY }
        });
        const data = await res.json();
        let logs = data.record.logs || [];

        // add reason field
        logs.unshift({ 
          name: nameInput, 
          reason: reasonInput || "No reason given", 
          timestamp: new Date().toISOString() 
        });

        logs = logs.slice(0, 8);

        await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            "X-Master-Key": JSONBIN_KEY,
            "X-Bin-Versioning": "false"
          },
          body: JSON.stringify({ logs })
        });

        renderLog(logs);
      } catch (err) {
        console.error("Failed to update log:", err);
      }
    }

    // Load log
    async function loadLog() {
      try {
        const res = await fetch(`https://api.jsonbin.io/v3/b/${JSONBIN_ID}/latest`, {
          headers: { "X-Master-Key": JSONBIN_KEY }
        });
        const data = await res.json();
        const logs = data.record.logs || [];
        renderLog(logs);
      } catch (err) {
        document.getElementById("logEntries").innerText = "Could not load log.";
        console.error(err);
      }
    }

    // Render logs in panel
    function renderLog(logs) {
      const container = document.getElementById("logEntries");
      container.innerHTML = "";
      logs.forEach((log, index) => {
        const div = document.createElement("div");
        div.className = "log-entry";

        const nameSpan = document.createElement("span");
        nameSpan.style.cursor = "pointer";
        nameSpan.style.fontWeight = "600";
        nameSpan.innerText = log.name.charAt(0).toUpperCase() + log.name.slice(1);
        nameSpan.onclick = () => {
          div.classList.toggle("open");
        };

        const timeDiv = document.createElement("div");
        timeDiv.style.fontSize = "12px";
        timeDiv.style.opacity = "0.8";
        timeDiv.innerText = new Date(log.timestamp).toLocaleString();

        const reasonDiv = document.createElement("div");
        reasonDiv.className = "reason-text";
        reasonDiv.innerText = "Reason: " + log.reason;

        div.appendChild(nameSpan);
        div.appendChild(timeDiv);
        div.appendChild(reasonDiv);
        container.appendChild(div);
      });
    }

    // Auto-refresh
    setInterval(loadLog, LOG_REFRESH_INTERVAL);

    // Load initially
    window.addEventListener("load", loadLog);

    // Initialize particles.js
    window.addEventListener('load', function() {
      if (typeof particlesJS !== 'undefined') {
        particlesJS("particles-js", {
          "particles": {
            "number": { "value": 80, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#ffffff" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.8, "random": true },
            "size": { "value": 3, "random": true },
            "line_linked": { "enable": false },
            "move": { "enable": true, "speed": 1, "direction": "none", "random": true }
          },
          "interactivity": {
            "events": {
              "onhover": { "enable": true, "mode": "repulse" },
              "onclick": { "enable": true, "mode": "push" }
            },
            "modes": {
              "repulse": { "distance": 100 },
              "push": { "particles_nb": 4 }
            }
          },
          "retina_detect": true
        });
      }
    });
  </script>
</body>
</html>
